<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Funebra Demo Gallery</title>
  <style>
    :root{ --bg:#0f1222; --panel:#171a2b; --ink:#eaf0ff; --muted:#a7b0c4; --accent:#7aa2ff; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:500 15px/1.5 system-ui,Segoe UI,Roboto;padding:20px}
    .wrap{max-width:980px;margin:0 auto}
    header{display:flex;flex-wrap:wrap;gap:14px;align-items:center;justify-content:space-between;margin:8px 0 16px}
    h1{font-size:22px;margin:0}
    .muted{color:var(--muted)}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:16px}
    .cats{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:6px 10px;border:1px solid rgba(255,255,255,.12);border-radius:999px;color:var(--ink);text-decoration:none}
    .chip.active{background:rgba(122,162,255,.15);border-color:var(--accent)}
    section.group{margin:18px 0}
    section.group h2{font-size:16px;margin:0 0 10px;color:#dfe6ff}
    ul.grid{list-style:none;margin:0;padding:0;display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
    a.tile{display:block;padding:12px 14px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.1);border-radius:12px;color:var(--ink);text-decoration:none;font-weight:600;transition:.2s}
    a.tile:hover{background:rgba(122,162,255,.15);border-color:var(--accent);color:#fff}
    .desc{display:block;font-weight:500;font-size:13px;color:var(--muted);margin-top:4px}
    footer{margin:22px 0 8px;font-size:13px;color:var(--muted);text-align:center}
    .notice{padding:10px 12px;border:1px dashed rgba(255,255,255,.25);border-radius:12px;margin:12px 0}
    .search{flex:1;min-width:220px}
    .search input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0e1120;color:var(--ink)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Funebra Math-Art Engine — Demo Gallery</h1>
        <div class="muted">No canvas • No SVG • Pure DOM demos</div>
      </div>
      <div class="search"><input id="q" placeholder="Search demos… (title or description)"></div>
    </header>

    <div class="card notice">This page auto-builds from <code>demos/demos.json</code>. Add a new demo there and it will appear here grouped by category.</div>

    <nav class="cats" id="cats"></nav>
    <div id="groups"></div>

    <footer>pLabs Entertainment © 2025 — Funebra Squad</footer>
  </div>

<script>
const S = {
  listUrl: 'demos.json', // relative to /demos/
};

const els = {
  cats: document.getElementById('cats'),
  groups: document.getElementById('groups'),
  q: document.getElementById('q'),
};

let DATA = [];
let ACTIVE_CAT = 'all';
let QUERY = '';

function slug(s){return String(s).toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');}

function renderCats(categories){
  els.cats.innerHTML = '';
  const all = document.createElement('a');
  all.href = '#all'; all.className = 'chip ' + (ACTIVE_CAT==='all'?'active':''); all.textContent = 'All';
  els.cats.appendChild(all);
  categories.forEach(c=>{
    const a=document.createElement('a');
    a.href = '#' + slug(c);
    a.className = 'chip ' + (ACTIVE_CAT===slug(c)?'active':'');
    a.textContent = c;
    els.cats.appendChild(a);
  });
}

function render(){
  const cats = [...new Set(DATA.map(d=>d.category))];
  renderCats(cats);

  const groups = {};
  DATA.forEach(d=>{
    if(ACTIVE_CAT!=='all' && slug(d.category)!==ACTIVE_CAT) return;
    const hay = (d.title + ' ' + (d.description||'')).toLowerCase();
    if(QUERY && !hay.includes(QUERY)) return;
    (groups[d.category] ||= []).push(d);
  });

  els.groups.innerHTML = '';
  Object.entries(groups).sort((a,b)=>a[0].localeCompare(b[0])).forEach(([cat,items])=>{
    items.sort((a,b)=>a.title.localeCompare(b.title));
    const sec=document.createElement('section'); sec.className='group';
    sec.id = slug(cat);
    sec.innerHTML = `<h2>${cat}</h2><ul class="grid"></ul>`;
    const ul=sec.querySelector('ul');
    items.forEach(d=>{
      const li=document.createElement('li');
      li.innerHTML = `<a class="tile" href="${d.file}">${d.title}<span class="desc">${d.description||''}</span></a>`;
      ul.appendChild(li);
    });
    els.groups.appendChild(sec);
  });

  // update active chip
  [...els.cats.querySelectorAll('.chip')].forEach(ch=>{
    ch.classList.toggle('active', ch.getAttribute('href')==='#'+ACTIVE_CAT);
  });
}

async function load(){
  try{
    const res = await fetch(S.listUrl);
    const json = await res.json();
    // Expect format: [{ file, title, category, description? }]
    DATA = json;
    // Default from hash
    if(location.hash){ ACTIVE_CAT = location.hash.replace('#','') || 'all'; }
    render();
  }catch(err){
    els.groups.innerHTML = `<div class='card' style='margin-top:12px'>Failed to load demos.json<br><small class='muted'>${err}</small></div>`;
  }
}

window.addEventListener('hashchange',()=>{
  ACTIVE_CAT = (location.hash||'#all').replace('#','');
  render();
});

els.q.addEventListener('input',()=>{ QUERY = els.q.value.trim().toLowerCase(); render(); });

load();
</script>
</body>
</html>
