
<!-- //10.34--04.04.021d[‚óá_‚óè]¬∞ -->
<!-- //02.16--05.11.017d[-_-]b -->
<!-- //afd.n2+13.18 wen.22.11.017d[-_-]b -->
<!-- //afd.n2stk008+13.18 sat.15.06.019d[O_.-.]b -->
<!-- //homepro+11.10 tir.22.11.022[O.o] -->
<HTML>
<LINK href="https://robot.at.ua/bluetooth/logo/star.png" rel="shortcut icon">

<head><title>pLabs Entertainment &copy; 2025</title>
  
  <!-- Import map to resolve bare module specifiers used by dependencies (e.g., "three") -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>
  
  <!-- Anti-flicker -->
  <script>
  var timeout = 3000;
  !function(h,i,d,e){var t,n=h.createElement("style");n.id=e,n.innerHTML="body{opacity:0}",h.head.appendChild(n),t=d,i.rmfk=function(){var t=h.getElementById(e);t&&t.parentNode.removeChild(t)},setTimeout(i.rmfk,t)}(document,window,timeout,"abhide");
  </script>

  <!-- Mida A/B -->
  <script async src="https://cdn.mida.so/js/optimize.js?key=9mv6yAGkYDA7LRJEzlN34O"></script>
  
  
  <!-- SEO / OG -->
  <meta name="description" content="A lightweight, hackable, browser-based math and art engine. Create geometry, chaos patterns, and visual experiments directly in your browser.">
  <meta name="keywords" content="math art engine, browser math tool, funebra, parametric art, geometry engine, geogebra alternative, hackable math studio">
  <meta name="author" content="Peter M. Lugha">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://funebra.github.io/math-art-engine/">

  <meta property="og:type" content="website">
  <meta property="og:url" content="https://funebra.github.io/math-art-engine/">
  <meta property="og:title" content="Math-Art Engine 1.0 ‚Äì Funebra">
  <meta property="og:description" content="Hackable, browser-based math-art studio.">
  <meta property="og:image" content="https://funebra.github.io/math-art-engine/assets/og/funebra-og.png">
  <meta property="og:image:secure_url" content="https://robot.at.ua/bluetooth/logo/star.png">
  <meta property="og:image:alt" content="Funebra star logo">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Math-Art Engine 1.0 ‚Äì Funebra">
  <meta name="twitter:description" content="Hackable, browser-based math-art studio.">
  <meta name="twitter:image" content="https://funebra.github.io/math-art-engine/assets/og/funebra-og.png">

  <link rel="icon" sizes="16x16" href="funebra_favicon_16.png">
  <link rel="icon" sizes="32x32" href="funebra_favicon_32.png">
  <link rel="icon" sizes="64x64" href="funebra_favicon_64.png">
  <link rel="apple-touch-icon" sizes="180x180" href="funebra_favicon_180.png">
  <meta name="theme-color" content="#0e1020">

  <!-- Legacy libs you rely on -->
  <script src="https://plabs.at.ua/game/aftermath.1.6.4/tool-2022-11-22-13-03-Tir.js"></script>
  <script src="https://plabs.at.ua/res/math.js"></script>
  <script src="https://plabs.at.ua/res/regulators.js"></script>
  <script src="https://plabs.at.ua/res/bgspec0012o021o.js"></script>
  <script src="https://plabs.at.ua/res/defObj.js"></script>
  <script src="https://plabs.at.ua/res/partner/jquery-1.9.1.min.js"></script>
  <script src="https://plabs.at.ua/res/maths001o017o.js"></script>
  <script src="https://plabs.at.ua/res/maths001o021o.js"></script>
  <script src="https://plabs.at.ua/game/sacred/defCon.js"></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7190047409728823" crossorigin="anonymous"></script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"Funebra Math-Art Engine",
    "applicationCategory":"EducationalApplication",
    "operatingSystem":"Web",
    "url":"https://funebra.github.io/math-art-engine/",
    "author":{"@type":"Organization","name":"pLabs Entertainment"}
  }
  </script>

  <!-- DOM snapshot for export -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  
 
  <style>
    

    html,body { height:100% }
    body { margin:0; background:rgb(200,200,230); color:red; }
 #funebraCanvas{position:fixed; inset:0; pointer-events:none; z-index:0; }
    #testPanel{position:fixed; top:8px; right:8px; background:rgba(0,0,0,.6); color:#cfe9cf; padding:.5rem .75rem; border-radius:.5rem; font:12px/1.4 system-ui,Segoe UI,Arial}
    #testPanel b{color:#fff}
    .ok{color:#9fff9f}
    .fail{color:#ff9f9f}
  
#tool, #page01, #page03 { position:relative; z-index:10; }
    #
    #stage { position:relative; width:100%; height:100%; overflow:hidden; }
    #exportBar {
      position:fixed; right:10px; bottom:10px; z-index:99999;
      display:flex; gap:8px; align-items:center;
      background:rgba(0,0,0,.5); padding:8px 10px; border-radius:8px; color:#fff;
      font:14px/1.2 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    }
    #exportBar button { border:0; border-radius:6px; padding:6px 10px; cursor:pointer; }
    #btnPng { background:#0ea5e9; color:#fff }
    #btnGif { background:#22c55e; color:#000 }
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: .001ms !important; animation-iteration-count: 1 !important; transition-duration: .001ms !important; }
    }

  </style>
</head>

  <script>
  if (typeof window.initEURWave !== 'function') {
    window.initEURWave = async function () { /* noop fallback */ };
  }
</script>
 
  
  
<!--  https://plabsfill.com/res/tool2021-04-04-1916.js -->
<script language="javascript" src="https://plabs.at.ua/game/aftermath.1.6.4/tool-2022-11-22-13-03-Tir.js"></script>
<script language="javascript" src="https://plabs.at.ua/res/math.js"></script>
    <script language="javascript" src="http://plabs.at.ua/res/regulators.js"></script>
<script language="javascript" src="https://plabs.at.ua/res/bgspec0012o021o.js"></script>
<SCRIPT language="javascript" src="https://plabs.at.ua/res/defObj.js"></script>
<script src=""></script>
<script src="https://plabs.at.ua/res/partner/jquery-1.9.1.min.js">
</script>


<!-- https://plabs.at.ua/game/home/tool2021-04-07-1958.js  section 2022 update-->
<script language="javascript" src="https://plabs.at.ua/game/home/matter.js"></script>
<script language="javascript" src="https://plabs.at.ua/res/maths001o017o.js"></script>
<script language="javascript" src="https://plabs.at.ua/res/maths001o021o.js"></script>
<script src="https://plabs.at.ua/game/sacred/defCon.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7190047409728823"
     crossorigin="anonymous"></script>
<!--                                                     section 2022 end -->


</head>




  <script>
  // Ensure overlay canvas exists ASAP so later tests don't fail
  (function ensureCanvas(){
    var cvs = document.getElementById('funebraCanvas');
    if (!cvs){
      cvs = document.createElement('canvas');
      cvs.id = 'funebraCanvas';
      cvs.style.position = 'fixed';
      cvs.style.inset = 0;
      cvs.style.pointerEvents = 'none';
      if (document.body) document.body.appendChild(cvs);
      else document.addEventListener('DOMContentLoaded', function(){
        if (!document.getElementById('funebraCanvas')) document.body.appendChild(cvs);
      });
    }
  })();
  </script>

  <script type="module">
   import Funebra from "https://funebra.github.io/math-art-engine/script.module-old.js";
const { makeParametric } = Funebra;

    const cvs = document.getElementById('funebraCanvas');
    const R = 120;
    const sides = 3;
    const turn = (i) => (i / sides) * Math.PI * 2 - Math.PI / 2; // point up

    let a = 0;
    function drawFunebra() {
      const { innerWidth:w, innerHeight:h } = window;
      const tri = makeParametric({
        x: (i) => Math.cos(turn(i)+a) * R + w/2,
        y: (i) => Math.sin(turn(i)+a) * R + h/2,
        steps: sides,
        close: true,
        color: "#ffb400"
      });
      Funebra.render([tri], { canvas: cvs, fill:true, stroke: "#ff6600", lineWidth: 2, clear: true });
      a += 0.01;
      requestAnimationFrame(drawFunebra);
    }
    requestAnimationFrame(drawFunebra);
    addEventListener('resize', () => { /* Funebra handles size on render */ });
    window.Funebra = Funebra;

  </script>


<body style="background:rgb(200, 200, 230);color:red;" onClick="osc2()" onLoad="initEURWave().then(() => {console.log('EUR data ready!');});">

  
   <!-- ===== Quick self-tests (act like test-cases) ===== -->
  <div id="testPanel">
    <b>Smoke Tests</b>
    <ul id="tests" style="margin:.25rem 0 0 .9rem; padding:0"></ul>
  </div>
  <script type="module">
    const T = document.getElementById('tests');
    const pass = (msg)=>{ const li=document.createElement('li'); li.className='ok'; li.textContent='‚úì '+msg; T.appendChild(li); };
    const fail = (msg,e)=>{ const li=document.createElement('li'); li.className='fail'; li.textContent='‚úó '+msg+ (e? ' ‚Äî '+(e.message||e):''); T.appendChild(li); };

    // Test 1: Import mapping for "three" resolves and is usable
    try {
      const THREE = await import('three');
      if (THREE.Vector3) {
        const v = new THREE.Vector3(1,2,3);
        pass('three import resolved (Vector3 length='+v.length().toFixed(3)+')');
      } else {
        fail('three import missing Vector3');
      }
    } catch(e){ fail('three import failed', e); }

    // Test 2: Funebra available OR graceful fallback
    try {
      const mod = await import('https://funebra.github.io/math-art-engine/script.module.js');
      if (mod && typeof mod.default?.render === 'function') pass('Funebra available');
      else pass('Funebra not available ‚Äî using canvas fallback');
    } catch(e){ pass('Funebra import error ‚Äî using canvas fallback'); }

    // Test 3: Canvas injected
    try {
      const c = document.getElementById('funebraCanvas');
      if (c) pass('funebraCanvas present');
      else fail('funebraCanvas missing');
    } catch(e){ fail('Canvas test failed', e); }

    // Test 4: Animation ticking (frame counter increases)
    try {
      const c = document.getElementById('funebraCanvas');
      let frames=0; const r = ()=>{ frames++; if(frames>10){ pass('animation ticking'); cancelAnimationFrame(id);} else { id=requestAnimationFrame(r);} };
      let id = requestAnimationFrame(r);
      setTimeout(()=>{ if(frames<=1) fail('animation did not tick'); }, 1000);
    } catch(e){ fail('Animation test failed', e); }

    // Test 5: mvx is globally available
    try {
      if (typeof window.mvx === 'function') {
        pass('mvx is globally available');
      } else {
        fail('mvx is not on window');
      }
    } catch(e){ fail('mvx availability test failed', e); }
  </script>

  <!-- ===== Legacy Aftermath UI (kept, corrected) ===== -->

  <!-- Minimal seed canvas kept (unused by Funebra layer) -->
  <canvas id="canvas" style="display:none"></canvas>

  
   <!-- export toolbar -->
<div id="exportBar" data-export-ignore>
 <button id="btnPng" type="button" aria-label="Export as PNG (P)" title="Export as PNG (P)">üì∏ Export PNG</button>
<button id="btnGif" type="button" aria-label="Export as GIF (G)" title="Export as GIF (G)">üéûÔ∏è Export GIF</button>
<button id="btnCancel" type="button" aria-label="Cancel export (Esc)" title="Cancel export (Esc)">‚èπ Cancel</button>
<script type="module">
  window.addEventListener('keydown', (e)=>{
    if (e.key.toLowerCase()==='p') btnPng.click();
    else if (e.key.toLowerCase()==='g') btnGif.click();
    else if (e.key==='Escape') btnCancel.click();
  });</script>
</div>


  <!-- drawing surface target 
  <div id="stage"></div>
-->
 
  
<script>


var x = 0; y = 0; i=600; iCount = 0;pCounter=new Array();
var deg2radians = Math.PI *2 / 360;amountOfp=-2;


h =0;
oi = 'DIV';
if(typeof oi == 'undefined'){oi = 'object';}
  
    if (typeof html2canvas !== 'function') {
  console.error('html2canvas not available'); 
}
  
function chngBG(){
document.body.style.background = selo.options[selo.selectedIndex].value;
}


var  ca=1;cb=324;cz=0;
function gear(){
if(ca <= 322){ca +=2;cz=ca;}
setTimeout("gear()",200);
}gear()

function osc1(){
if(ca == 323){if(cb > 1)
cb -= 1; cz = cb;
}if(cb == 1){cb = 324;ca=1;}
window.setTimeout("osc1()", 200);
}osc1();

function osc2(){}


function printit(){
pTool1();
if(h < 1024){
   h=h+1;status=h;

ojy = document.createElement(oi);
ojy.style.position = 'absolute';
ojy.id = 'bn'+h;
ojy.onclick= function() { mPosition.value = this.id.substring(2, this.id.Length); oDef.innerText = eval('bn'+this.id.substring(2, this.id.Length)).innerHTML;}
ojy.style.cursor='hand';
document.body.appendChild(ojy);
if(h == 20)document.body.innerHTML += "<div id='pcontrol' style='background:url(https://plabs.at.ua/bluetooth/trans/still/block_0_0_0.jpg);width:410px;color:black;'><input type='button' value='PaintV..X' onClick='mvx()'><b id='oo'></b>"+
   "<input id='steps' value='3' type='text' style='width:30;'><b style='background-color:silver;cursor:hand;' onClick='tul("+'stepper'+")'>:  o  </b><input id='eLoop' type='checkbox' checked='false'><br>"+
"<div id='stepper' style='background:black;visibility:hidden;'><input id='stpStart' value='0' type='text' style='width:30;'><---><input id='stpEnd' value='717' type='text' style='width:45;'><b style='background-color:silver;cursor:hand;' onClick='tul("+'stepper'+")'>: Steps</b></div><br>"+
   "<input id='scodeX' type='text' value='rings[u+zx+3]+180' style='background:url(https://plabs.at.ua/bluetooth/trans/still/black.png)100% 100%/100% 100%;color:rgb(200, 200, 230);width:340px;'><b style='background-color:silver'> :x</b><br>"+
   "<input id='scodeY' type='text' value='rings[u+zx+4]+360' style='background:url(https://plabs.at.ua/bluetooth/trans/still/black.png)100% 100%/100% 100%;color:rgb(200, 200, 230);width:340px;'><b style='background-color:silver'> :y</b><br>"+
   "<input id='clor' type='text' value='"+'"rgb("+(cos(iu*cz/120)*360+255)/2+", "+125+","+(cos(iu*gta/120)*360+255)/2+")"'+"' style='background:url(https://plabs.at.ua/bluetooth/trans/still/black.png)100% 100%/100% 100%;color:rgb(200, 200, 230);width:340px;'><b style='background-color:silver'> :Color</b>"+lev+
   "<input id='itext' type='text' style='width:340px;' value='"+'"&#9787;"'+"'><b style='background-color:silver'> :iText</b><br>"+















   "<input type='button' value='toolz' onClick='tul("+'tool'+");tul("+'page01'+");"+
   "if(eLoop.checked == false){tul("+'pl80'+");tul("+'demLim'+")}'>"+
  "<input type='button' value ='Cleanup' onclick ='bn1.innerHTML=&quot;&quot;'>"+

"<br><input type='text' id='dta' value='2048' style='width:40;background:url(https://plabs.at.ua/bluetooth/trans/still/green.png);'>"+


"</div><div id='pl80' style='position:absolute;background:lightblue;visibility:hidden;width:200;height:160;z-Index:2;'></div>";
   window.setTimeout("printit()",50);
 }
}
o =0;var lTmer =0;hPntz =0;
function detrm(){
o = eval(mPosition.value);
}
function def(){
eval('bn'+mPosition.value).innerHTML = oDef.value;
}
var isIndex = [];
ob =0;isId = 0;u=0;iu=600;zx=0;
function mvx(){


if(eLoop.checked = 'true' && steps.value >= 0 ){;status=x;}
if(o <= Math.floor(eval(stpEnd.value) / eval(steps.value))){o = o+eval(eval(stpStart.value)+eval(steps.value));m='bn'+o;oo.innerText=o;ob=ob+1;isId +=1;u+=1;
             iu = u*3;zx=zx+1*2;
             i = i-eval(steps.value);
              iCount += 3.1415;
                                  rad = iCount * deg2radians;
with(Math){      costheta = cos(rad);
                                  sintheta = sin(rad);
                                         x = x + costheta;
                                         y = y + sintheta;
  if(chk.checked == true){
document.getElementById(m).style.zIndex = o;

if(clor.value.substring(1, 4)=='rgb'){
document.getElementById(m).innerHTML=eval(itext.value);
document.getElementById(m).style.fontSize='14pt';
document.getElementById(m).style.color = eval(clor.value);
//document.getElementById(m).style.width = eval(wL.value); document.getElementById(m).style.height = eval(hT.value);
}  

if(clor.value.substring(3,7)=='blue'){
document.getElementById(m).innerHTML = "<img id='io"+ob+"' src='"+eval(clor.value)+"' width='"+eval(wL.value)+
                                       "' height='"+eval(hT.value)+"'>";}
if(clor.value.substring(1,5)=='http'){
document.getElementById(m).innerHTML = "<img id='io"+ob+"' src='"+eval(clor.value)+"' width='"+eval(wL.value)+
                                       "' height='"+eval(hT.value)+"'>";}  
document.getElementById(m).style.top = eval(scodeY.value) + "px";
document.getElementById(m).style.left = eval(scodeX.value) + "px";
isIndex[isId]=round(eval(m).style.top.substring(0,eval(m).style.top.length-2))+','+round(eval(m).style.left.substring(0,eval(m).style.left.length-2))+','+round(eval(m).style.left.substring(0,eval(m).style.left.length-2));
}};setTimeout("mvx()", eval(dta.value));
}else{o = 0;x = 0;i = 600;y = 0;ob = 0;u=0;iu=600;zx=0;}
}


/*
var falso = new ActiveXObject("Scripting.FileSystemObject");
function mSave(){
var a = falso.CreateTextFile(".\\3Dcoords.txt", true);
    a.WriteLine(isIndex);
    a.Close();
}  */



scounter = 0;


function xIt(){lvel = steps.value +3;}
function opaz(){msp = selo.options[selo.selectedIndex].value;

clor.value = msp.substring(4, msp.length -1);}
function tul(ctr){
if(ctr.style.visibility == 'hidden'){
//page01.style.visibility = '';
ctr.style.visibility ="";
}else{ctr.style.visibility = 'hidden';}}

printit();

function printpetit(soda){
if(soda==0){printit();}
          else{soda=soda-1;}
}
 gta = 360;
function execon(){
if(gta > 0){
    gta = gta-1;
eval(oDef.value);
window.setTimeout("execon()", dta.value);
}else{
       gta = 360;
}
}
</script>
<script src="https://plabs.at.ua/res/partner/download.js">
</script>

  
 <script type="module">
  const onReady = (fn) => {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', fn, { once: true });
    } else {
      fn();
    }
  };
</script>






  

<script type="module">
  onReady(() => {
    const bar = document.getElementById('exportBar');
    const expStatus = document.getElementById('expStatus');
    const btnPng = document.getElementById('btnPng');

    if (!bar || !expStatus || !btnPng) return; // elements missing; abort cleanly

    const captureTarget = document.body;
    const dpr = Math.min(2, window.devicePixelRatio || 1);

    const commonCaptureOpts = {
      useCORS: true,
      backgroundColor: null,
      scale: dpr,
      ignoreElements: (el) =>
        el && (el.id === 'exportBar' || (el.hasAttribute && el.hasAttribute('data-export-ignore')))
    };

    const temporarilyHide = (el) => {
      if (!el) return () => {};
      const old = el.style.visibility;
      el.style.visibility = 'hidden';
      return () => { el.style.visibility = old; };
    };

    btnPng.addEventListener('click', async () => {
      if (typeof html2canvas !== 'function') {
        console.error('html2canvas not available');
        expStatus.textContent = ' ‚ö†Ô∏è PNG failed: html2canvas missing';
        return;
      }
      expStatus.textContent = ' Capturing PNG‚Ä¶';
      btnPng.disabled = true;

      const restore = temporarilyHide(bar);
      try {
        const canvas = await html2canvas(captureTarget, commonCaptureOpts);
        await new Promise(r => requestAnimationFrame(r));
        canvas.toBlob((blob) => {
          if (!blob) { expStatus.textContent = ' ‚ö†Ô∏è PNG failed (no blob)'; return; }
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'funebra_snapshot.png';
          a.click();
          URL.revokeObjectURL(a.href);
          expStatus.textContent = ' ‚úÖ PNG saved';
        }, 'image/png');
      } catch (err) {
        console.error(err);
        expStatus.textContent = ' ‚ö†Ô∏è PNG failed (see console)';
      } finally {
        restore();
        btnPng.disabled = false;
      }
    }, { passive: true });
  });
</script>


<script type="module">
  onReady(() => {
    const bar = document.getElementById('exportBar');
    const expStatus = document.getElementById('expStatus');
    const btnGif = document.getElementById('btnGif');
    const btnPng = document.getElementById('btnPng');
    const btnCancel = document.getElementById('btnCancel');

    if (!bar || !expStatus || !btnGif || !btnPng || !btnCancel) return;

    const captureTarget = document.body;
    const dpr = Math.min(2, window.devicePixelRatio || 1);
    const totalFrames = 180;
    const delayMs = 40;
    let cancelled = false;

    const commonCaptureOpts = {
      useCORS: true,
      backgroundColor: null,
      scale: dpr,
      ignoreElements: (el) =>
        el && (el.id === 'exportBar' || (el.hasAttribute && el.hasAttribute('data-export-ignore')))
    };

    const temporarilyHide = (el) => {
      if (!el) return () => {};
      const old = el.style.visibility;
      el.style.visibility = 'hidden';
      return () => { el.style.visibility = old; };
    };

    const captureFrame = async () => {
      await new Promise(r => requestAnimationFrame(r));
      return html2canvas(captureTarget, commonCaptureOpts);
    };

    const prepareGif = async (width, height) => {
      await import('https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.min.js');
      const res = await fetch('https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.worker.js');
      if (!res.ok) throw new Error('Failed to fetch gif.worker.js');
      const workerUrl = URL.createObjectURL(await res.blob());
      const gif = new window.GIF({ workers: 4, workerScript: workerUrl, quality: 10, width, height });
      gif.on('finished', () => URL.revokeObjectURL(workerUrl));
      return gif;
    };

    btnGif.addEventListener('click', async () => {
      if (typeof html2canvas !== 'function') {
        console.error('html2canvas not available');
        expStatus.textContent = ' ‚ö†Ô∏è GIF failed: html2canvas missing';
        return;
      }

      btnGif.disabled = true;
      btnPng.disabled = true;
      btnCancel.style.display = '';
      cancelled = false;

      const restore = temporarilyHide(bar);
      const onCancel = () => { cancelled = true; expStatus.textContent = ' Cancelling‚Ä¶'; };
      btnCancel.addEventListener('click', onCancel, { once: true });

      try {
        expStatus.textContent = ' Measuring‚Ä¶';
        const first = await captureFrame();
        const gif = await prepareGif(first.width, first.height);

        gif.on('progress', (p) => {
          const pct = Math.max(0, Math.min(100, Math.round(p * 100)));
          expStatus.textContent = ` Encoding‚Ä¶ ${pct}%`;
        });

        expStatus.textContent = ` Recording 1/${totalFrames}‚Ä¶`;
        gif.addFrame(first, { copy: true, delay: delayMs });

        for (let i = 1; i < totalFrames; i++) {
          if (cancelled) break;
          expStatus.textContent = ` Recording ${i + 1}/${totalFrames}‚Ä¶`;
          const canvas = await captureFrame();
          gif.addFrame(canvas, { copy: true, delay: delayMs });
        }

        if (!cancelled) {
          expStatus.textContent = ' Finalizing‚Ä¶';
          gif.on('finished', (blob) => {
            const url = URL.createObjectURL(blob);
            const ts = new Date().toISOString().replace(/[:.]/g, '-');
            const a = document.createElement('a');
            a.href = url;
            a.download = `funebra_animation_${ts}.gif`;
            a.click();
            URL.revokeObjectURL(url);
            expStatus.textContent = ' ‚úÖ GIF saved';
          });
          gif.render();
        } else {
          expStatus.textContent = ' ‚ùé GIF cancelled';
        }
      } catch (err) {
        console.error(err);
        expStatus.textContent = ' ‚ö†Ô∏è GIF failed (see console)';
      } finally {
        restore();
        btnGif.disabled = false;
        btnPng.disabled = false;
        btnCancel.style.display = 'none';
      }
    }, { passive: true });
  });
</script>


  
</body>
</html>

